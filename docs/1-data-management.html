<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>1&nbsp; Data Management – The Elastic Certified Engineer Exam v8.1 Study Guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./2-searching-data.html" rel="next">
<link href="./0.2-intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./1-data-management.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data Management</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The Elastic Certified Engineer Exam v8.1 Study Guide</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0.1-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0.2-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-data-management.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data Management</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-searching-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Searching Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-developing-search-applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Developing Search Applications</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4-data-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Processing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5-cluster-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Cluster Management</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6-appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#task-define-an-index-that-satisfies-a-given-set-of-requirements" id="toc-task-define-an-index-that-satisfies-a-given-set-of-requirements" class="nav-link active" data-scroll-target="#task-define-an-index-that-satisfies-a-given-set-of-requirements"><span class="header-section-number">1.1</span> Task: Define an index that satisfies a given set of requirements</a>
  <ul class="collapse">
  <li><a href="#example-1-creating-an-index-for-a-blogging-platform" id="toc-example-1-creating-an-index-for-a-blogging-platform" class="nav-link" data-scroll-target="#example-1-creating-an-index-for-a-blogging-platform">Example 1: Creating an Index for a Blogging Platform</a></li>
  <li><a href="#example-2-creating-an-index-for-log-data" id="toc-example-2-creating-an-index-for-log-data" class="nav-link" data-scroll-target="#example-2-creating-an-index-for-log-data">Example 2: Creating an Index for Log Data</a></li>
  <li><a href="#example-3-creating-an-index-for-e-commerce-product-data-with-daily-updates" id="toc-example-3-creating-an-index-for-e-commerce-product-data-with-daily-updates" class="nav-link" data-scroll-target="#example-3-creating-an-index-for-e-commerce-product-data-with-daily-updates">Example 3: Creating an index for e-commerce product data with daily updates</a></li>
  </ul></li>
  <li><a href="#task-define-and-use-an-index-template-for-a-given-pattern-that-satisfies-a-given-set-of-requirements" id="toc-task-define-and-use-an-index-template-for-a-given-pattern-that-satisfies-a-given-set-of-requirements" class="nav-link" data-scroll-target="#task-define-and-use-an-index-template-for-a-given-pattern-that-satisfies-a-given-set-of-requirements"><span class="header-section-number">1.2</span> Task: Define and use an index template for a given pattern that satisfies a given set of requirements</a>
  <ul class="collapse">
  <li><a href="#example-1-creating-an-index-template-for-a-user-profile-data" id="toc-example-1-creating-an-index-template-for-a-user-profile-data" class="nav-link" data-scroll-target="#example-1-creating-an-index-template-for-a-user-profile-data">Example 1: Creating an index template for a user profile data</a></li>
  <li><a href="#example-2-creating-a-monthly-product-index-template" id="toc-example-2-creating-a-monthly-product-index-template" class="nav-link" data-scroll-target="#example-2-creating-a-monthly-product-index-template">Example 2: Creating a monthly product index template</a></li>
  <li><a href="#example-3-creating-an-index-template-for-log-indices" id="toc-example-3-creating-an-index-template-for-log-indices" class="nav-link" data-scroll-target="#example-3-creating-an-index-template-for-log-indices">Example 3: Creating an index template for log indices</a></li>
  </ul></li>
  <li><a href="#task-define-and-use-a-dynamic-template-that-satisfies-a-given-set-of-requirements" id="toc-task-define-and-use-a-dynamic-template-that-satisfies-a-given-set-of-requirements" class="nav-link" data-scroll-target="#task-define-and-use-a-dynamic-template-that-satisfies-a-given-set-of-requirements"><span class="header-section-number">1.3</span> Task: Define and use a dynamic template that satisfies a given set of requirements</a>
  <ul class="collapse">
  <li><a href="#example-1-create-a-dynamic-template-for-logging-using-field-name-patterns" id="toc-example-1-create-a-dynamic-template-for-logging-using-field-name-patterns" class="nav-link" data-scroll-target="#example-1-create-a-dynamic-template-for-logging-using-field-name-patterns">Example 1: Create a Dynamic Template for Logging Using Field Name Patterns</a></li>
  <li><a href="#example-2-create-dynamic-template-for-data-types" id="toc-example-2-create-dynamic-template-for-data-types" class="nav-link" data-scroll-target="#example-2-create-dynamic-template-for-data-types">Example 2: Create Dynamic Template for Data Types</a></li>
  <li><a href="#example-3-create-a-dynamic-template-for-logging-data-for-data-patterns" id="toc-example-3-create-a-dynamic-template-for-logging-data-for-data-patterns" class="nav-link" data-scroll-target="#example-3-create-a-dynamic-template-for-logging-data-for-data-patterns">Example 3: Create a Dynamic Template for Logging Data for Data Patterns</a></li>
  </ul></li>
  <li><a href="#task-define-an-index-lifecycle-management-policy-for-a-timeseries-index" id="toc-task-define-an-index-lifecycle-management-policy-for-a-timeseries-index" class="nav-link" data-scroll-target="#task-define-an-index-lifecycle-management-policy-for-a-timeseries-index"><span class="header-section-number">1.4</span> Task: Define an Index Lifecycle Management policy for a timeseries index</a>
  <ul class="collapse">
  <li><a href="#example-1-creating-an-ilm-policy-for-log-data-indices" id="toc-example-1-creating-an-ilm-policy-for-log-data-indices" class="nav-link" data-scroll-target="#example-1-creating-an-ilm-policy-for-log-data-indices">Example 1: Creating an ILM policy for log data indices</a></li>
  <li><a href="#example-2-creating-an-ilm-policy-for-logs-indices-retention-for-7-30-and-90-days" id="toc-example-2-creating-an-ilm-policy-for-logs-indices-retention-for-7-30-and-90-days" class="nav-link" data-scroll-target="#example-2-creating-an-ilm-policy-for-logs-indices-retention-for-7-30-and-90-days">Example 2: Creating an ILM policy for logs indices retention for 7, 30 and 90 days</a></li>
  <li><a href="#example-3-creating-an-ilm-policy-for-sensor-data-collected-every-hour-with-daily-rollover-and-retention-for-one-month" id="toc-example-3-creating-an-ilm-policy-for-sensor-data-collected-every-hour-with-daily-rollover-and-retention-for-one-month" class="nav-link" data-scroll-target="#example-3-creating-an-ilm-policy-for-sensor-data-collected-every-hour-with-daily-rollover-and-retention-for-one-month">Example 3: Creating an ILM policy for sensor data collected every hour, with daily rollover and retention for one month</a></li>
  </ul></li>
  <li><a href="#task-define-an-index-template-that-creates-a-new-data-stream" id="toc-task-define-an-index-template-that-creates-a-new-data-stream" class="nav-link" data-scroll-target="#task-define-an-index-template-that-creates-a-new-data-stream"><span class="header-section-number">1.5</span> Task: Define an index template that creates a new data stream</a>
  <ul class="collapse">
  <li><a href="#example-1-creating-an-index-template-for-continuously-flowing-application-logs" id="toc-example-1-creating-an-index-template-for-continuously-flowing-application-logs" class="nav-link" data-scroll-target="#example-1-creating-an-index-template-for-continuously-flowing-application-logs">Example 1: Creating an index template for continuously flowing application logs</a></li>
  <li><a href="#example-2-creating-an-index-template-for-continuously-flowing-application-logs-with-defined-fields" id="toc-example-2-creating-an-index-template-for-continuously-flowing-application-logs-with-defined-fields" class="nav-link" data-scroll-target="#example-2-creating-an-index-template-for-continuously-flowing-application-logs-with-defined-fields">Example 2: Creating an index template for continuously flowing application logs with defined fields</a></li>
  <li><a href="#example-3-creating-a-metrics-data-stream-for-application-performance-monitoring" id="toc-example-3-creating-a-metrics-data-stream-for-application-performance-monitoring" class="nav-link" data-scroll-target="#example-3-creating-a-metrics-data-stream-for-application-performance-monitoring">Example 3: Creating a metrics data stream for application performance monitoring</a></li>
  <li><a href="#example-4-defining-a-data-stream-with-specific-lifecycle-policies" id="toc-example-4-defining-a-data-stream-with-specific-lifecycle-policies" class="nav-link" data-scroll-target="#example-4-defining-a-data-stream-with-specific-lifecycle-policies">Example 4: Defining a Data Stream with Specific Lifecycle Policies</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data Management</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="task-define-an-index-that-satisfies-a-given-set-of-requirements" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="task-define-an-index-that-satisfies-a-given-set-of-requirements"><span class="header-section-number">1.1</span> Task: Define an index that satisfies a given set of requirements</h2>
<section id="example-1-creating-an-index-for-a-blogging-platform" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-1-creating-an-index-for-a-blogging-platform">Example 1: Creating an Index for a Blogging Platform</h3>
<section id="requirements" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements">Requirements</h4>
<ul>
<li>The platform hosts articles, each with <code>text</code> content, a publication date, author details, and tags.</li>
<li>Articles need to be searchable by <code>content</code>, <code>title</code>, and <code>tags</code>.</li>
<li>The application requires fast search responses and efficient storage.</li>
<li>The application should handle date-based queries efficiently.</li>
<li>Author details are nested objects that include the author’s name and email.</li>
</ul>
</section>
<section id="steps" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps">Steps</h4>
<ol class="example" type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p><strong>Define Mappings:</strong></p>
<ul>
<li><strong>Content and Title:</strong> Use the <code>text</code> data type</li>
<li><strong>Publication Date:</strong> Use the <code>date</code> data type</li>
<li><strong>Tags:</strong> Use the <code>keyword</code> data type for exact matching</li>
<li><strong>Author:</strong> Use a <code>nested</code> object to keep author details searchable and well-structured</li>
</ul></li>
<li><p>Create the index</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">blog_articles</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"number_of_shards"</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"number_of_replicas"</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"title"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"content"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"publication_date"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"date"</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"author"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"nested"</span><span class="fu">,</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"name"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">},</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"email"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"tags"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Or insert the settings and mappings separately.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">blog_articles</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"number_of_shards"</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"number_of_replicas"</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">blog_articles/_mapping</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"title"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"content"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"publication_date"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"date"</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"author"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"nested"</span><span class="fu">,</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"name"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"email"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"tags"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test">Test</h4>
<ol type="1">
<li><p>Verify the index</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_cat/indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify the mappings</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/blog_articles/_mapping</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Index and search for a document</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="er">#</span> <span class="er">Index</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">/blog_articles/_doc</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"title"</span> <span class="fu">:</span> <span class="st">"My First Blog Post"</span><span class="fu">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"content"</span> <span class="fu">:</span> <span class="st">"What an interesting way to go..."</span><span class="fu">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"publication_date"</span> <span class="fu">:</span> <span class="st">"2024-05-15"</span><span class="fu">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"tags"</span> <span class="fu">:</span> <span class="st">"superb"</span><span class="fu">,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"author"</span> <span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"name"</span> <span class="fu">:</span> <span class="st">"John Doe"</span><span class="fu">,</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"email"</span> <span class="fu">:</span> <span class="st">"john@doe.com"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="er">#</span> <span class="er">Search</span> <span class="er">like</span> <span class="er">this</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/blog_articles/_search</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="er">#</span> <span class="er">Or</span> <span class="er">search</span> <span class="er">like</span> <span class="er">this</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/blog_articles/_search?q=tags:superb</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="er">#</span> <span class="er">Or</span> <span class="er">search</span> <span class="er">like</span> <span class="er">this</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">blog_articles/_search</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"query"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"query_string"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"default_field"</span><span class="fu">:</span> <span class="st">"tags"</span><span class="fu">,</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"query"</span><span class="fu">:</span> <span class="st">"superb"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="er">#</span> <span class="er">Or</span> <span class="er">search</span> <span class="er">like</span> <span class="er">this</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">blog_articles/_search</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"query"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"nested"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"path"</span><span class="fu">:</span> <span class="st">"author"</span><span class="fu">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"query"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"match"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"author.name"</span><span class="fu">:</span> <span class="st">"john"</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<h4 id="considerations" class="unnumbered anchored">Considerations</h4></li>
</ol>
<ul>
<li><strong>Shards and Replicas:</strong> Adjust these settings based on expected data volume and query load.</li>
<li><strong>Nested Objects:</strong> These are crucial for maintaining the structure and searchability of complex data like author details.</li>
</ul>
</section>
<section id="clean-up-optional" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional">Clean-up (optional)</h4>
<ul>
<li><p>In the console execute the following</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">blog_articles</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/cat-indices.html" target="_blank">cat indices API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-create-index.html" target="_blank">Create Index API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/cat-indices.html" target="_blank">Get mapping API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/search-search.html" target="_blank">Search API</a></li>
</ul>
</section>
</section>
<section id="example-2-creating-an-index-for-log-data" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-2-creating-an-index-for-log-data">Example 2: Creating an Index for Log Data</h3>
<section id="requirements-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-1">Requirements</h4>
<ol type="1">
<li>Store log data with a timestamp field</li>
</ol>
</section>
<section id="steps-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-1">Steps</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create the index</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/log_data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"number_of_shards"</span><span class="fu">:</span> <span class="dv">3</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"@timestamp"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"date"</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"log_source"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"message"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-1">Test</h4>
<ol type="1">
<li><p>Verify the index creation</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/log_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Or</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_cat/indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify the field mapping</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/log_data/_mapping</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Index and search for a sample document</p>
<ol type="1">
<li><p>Index</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/log_data/_doc/1</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"@timestamp"</span><span class="fu">:</span> <span class="st">"2023-05-16T12:34:56Z"</span><span class="fu">,</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"log_source"</span><span class="fu">:</span> <span class="st">"web_server"</span><span class="fu">,</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"message"</span><span class="fu">:</span> <span class="st">"HTTP request received"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Search</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/log_data/_search</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The response should show the indexed document.</p></li>
</ol></li>
</ol>
</section>
<section id="considerations-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-1">Considerations</h4>
<ul>
<li>In <code>settings</code>, <code>number_of_replicas</code> doesn’t appear as its default is set to one 1 which is sufficient. The field <code>number_of_shards</code> should be higher than 1 depending on the requirements for a log index. No, you do not need to have a settings block for the index to be created.</li>
<li>The <code>@timestamp</code> field is mapped as a date type for time-based data management.</li>
<li>The <code>log_source</code> field is mapped as a <code>keyword</code> type to enable custom routing based on its value.</li>
</ul>
</section>
<section id="clean-up-optional-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-1">Clean-up (optional)</h4>
<ul>
<li><p>In the console execute the following</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">log_data</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-1">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/cat-indices.html" target="_blank">cat indices API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-create-index.html" target="_blank">Create Index API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/cat-indices.html" target="_blank">Get mapping API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/search-search.html" target="_blank">Search API</a></li>
</ul>
</section>
</section>
<section id="example-3-creating-an-index-for-e-commerce-product-data-with-daily-updates" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-3-creating-an-index-for-e-commerce-product-data-with-daily-updates">Example 3: Creating an index for e-commerce product data with daily updates</h3>
<section id="requirements-2" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-2">Requirements</h4>
<ol type="1">
<li>Store product information including <code>name</code>, <code>description</code>, <code>category</code>, <code>price</code>, and <code>stock_level</code>.</li>
<li>Allow filtering and searching based on product <code>name</code>, <code>category</code>, and <code>price</code> range.</li>
<li>Enable aggregations to calculate average price per category.</li>
</ol>
</section>
<section id="steps-2" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-2">Steps</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Define mappings:</p>
<ul>
<li>Use the <code>text</code> data type for <code>name</code> and <code>description</code> to allow full-text search.</li>
<li>Use the <code>keyword</code> data type for <code>category</code> to enable filtering by exact terms.</li>
<li>Use the <code>integer</code> data type for <code>price</code> to allow for range queries and aggregations.</li>
<li>Use the <code>integer</code> data type for <code>stock_level</code> for inventory management.</li>
</ul></li>
<li><p>Create the index</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">products</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"name"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span> <span class="fu">},</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"description"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span> <span class="fu">},</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"category"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span> <span class="fu">},</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"price"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span> <span class="fu">},</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"stock_level"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span> <span class="fu">}</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
<ul>
<li><p><strong>Configure analyzers (optional):</strong></p>
<ul>
<li>You can define custom analyzers for <code>name</code> and <code>description</code> to handle special characters or stemming based on your needs. Notice two things:
<ol type="1">
<li><p>How the <code>custom_analyzer</code> refers to the <code>filter</code> and <code>tokenizer</code> (both of which are optional).</p></li>
<li><p>The fields that will use <code>custom_analyzer</code>, <code>name</code> and <code>description</code>, have an analyzer reference to <code>custom_analyzer</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/products</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"analysis"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"tokenizer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"custom_tokenizer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"standard"</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"filter"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"custom_stemmer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"stemmer"</span><span class="fu">,</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"english"</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"custom_stop"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"stop"</span><span class="fu">,</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"stopwords"</span><span class="fu">:</span> <span class="st">"_english_"</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"custom_analyzer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"custom"</span><span class="fu">,</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"tokenizer"</span><span class="fu">:</span> <span class="st">"custom_tokenizer"</span><span class="fu">,</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"filter"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">"lowercase"</span><span class="ot">,</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">"custom_stop"</span><span class="ot">,</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">"custom_stemmer"</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>          <span class="ot">]</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"name"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span><span class="fu">,</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="st">"custom_analyzer"</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"description"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span><span class="fu">,</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="st">"custom_analyzer"</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"category"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"price"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"stock_level"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol></li>
</ul></li>
</ul>
</section>
<section id="test-2" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-2">Test</h4>
<ol type="1">
<li><p>Verify the index creation</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">products</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Or</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_cat/indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify the field mapping</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/products/_mapping</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Index and search some sample product data</p>
<ol type="1">
<li><p>Index some products</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">/products/_bulk</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">"products"</span><span class="fu">,</span> <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"1"</span> <span class="fu">}</span> <span class="fu">}</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Wireless Bluetooth Headphones"</span><span class="fu">,</span> <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"High-quality wireless Bluetooth headphones with noise-cancellation and long battery life."</span><span class="fu">,</span> <span class="dt">"category"</span><span class="fu">:</span> <span class="st">"electronics"</span><span class="fu">,</span> <span class="dt">"price"</span><span class="fu">:</span> <span class="dv">99</span><span class="fu">,</span> <span class="dt">"stock_level"</span><span class="fu">:</span> <span class="dv">250</span> <span class="fu">}</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">"products"</span><span class="fu">,</span> <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"2"</span> <span class="fu">}</span> <span class="fu">}</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Stainless Steel Water Bottle"</span><span class="fu">,</span> <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Durable stainless steel water bottle, keeps drinks cold for 24 hours and hot for 12 hours."</span><span class="fu">,</span> <span class="dt">"category"</span><span class="fu">:</span> <span class="st">"home"</span><span class="fu">,</span> <span class="dt">"price"</span><span class="fu">:</span> <span class="dv">25</span><span class="fu">,</span> <span class="dt">"stock_level"</span><span class="fu">:</span> <span class="dv">500</span> <span class="fu">}</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">"products"</span><span class="fu">,</span> <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"3"</span> <span class="fu">}</span> <span class="fu">}</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Smartphone"</span><span class="fu">,</span> <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Latest model smartphone with high-resolution display and fast processor."</span><span class="fu">,</span> <span class="dt">"category"</span><span class="fu">:</span> <span class="st">"electronics"</span><span class="fu">,</span> <span class="dt">"price"</span><span class="fu">:</span> <span class="dv">699</span><span class="fu">,</span> <span class="dt">"stock_level"</span><span class="fu">:</span> <span class="dv">150</span> <span class="fu">}</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">"products"</span><span class="fu">,</span> <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"4"</span> <span class="fu">}</span> <span class="fu">}</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"LED Desk Lamp"</span><span class="fu">,</span> <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Energy-efficient LED desk lamp with adjustable brightness and flexible neck."</span><span class="fu">,</span> <span class="dt">"category"</span><span class="fu">:</span> <span class="st">"home"</span><span class="fu">,</span> <span class="dt">"price"</span><span class="fu">:</span> <span class="dv">45</span><span class="fu">,</span> <span class="dt">"stock_level"</span><span class="fu">:</span> <span class="dv">300</span> <span class="fu">}</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">"products"</span><span class="fu">,</span> <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"5"</span> <span class="fu">}</span> <span class="fu">}</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"4K Ultra HD TV"</span><span class="fu">,</span> <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"55-inch 4K Ultra HD TV with HDR support and smart features."</span><span class="fu">,</span> <span class="dt">"category"</span><span class="fu">:</span> <span class="st">"electronics"</span><span class="fu">,</span> <span class="dt">"price"</span><span class="fu">:</span> <span class="dv">499</span><span class="fu">,</span> <span class="dt">"stock_level"</span><span class="fu">:</span> <span class="dv">200</span> <span class="fu">}</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">"products"</span><span class="fu">,</span> <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"6"</span> <span class="fu">}</span> <span class="fu">}</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Vacuum Cleaner"</span><span class="fu">,</span> <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"High-suction vacuum cleaner with multiple attachments for versatile cleaning."</span><span class="fu">,</span> <span class="dt">"category"</span><span class="fu">:</span> <span class="st">"home"</span><span class="fu">,</span> <span class="dt">"price"</span><span class="fu">:</span> <span class="dv">120</span><span class="fu">,</span> <span class="dt">"stock_level"</span><span class="fu">:</span> <span class="dv">100</span> <span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Search</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/products/_search?q=name:desk</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol></li>
<li><p>Use aggregations to calculate the average price per category.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">/products/_search</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"size"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"aggs"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"average_price_per_category"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"terms"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"field"</span><span class="fu">:</span> <span class="st">"category"</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"aggs"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"average_price"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"avg"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"field"</span><span class="fu">:</span> <span class="st">"price"</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="considerations-2" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-2">Considerations</h4>
<ul>
<li>Using the appropriate data types ensures efficient storage and querying capabilities.</li>
<li>Text fields allow full-text search, while keyword fields enable filtering by exact terms.</li>
</ul>
</section>
<section id="clean-up-optional-2" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-2">Clean-up (optional)</h4>
<ul>
<li><p>In the console execute the following</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">products</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-2" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-2">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/search-aggregations.html" target="_blank">Aggregations</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/cat-indices.html" target="_blank">cat indices API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-create-index.html" target="_blank">Create Index API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/cat-indices.html" target="_blank">Get mapping API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/search-search.html" target="_blank">Search API</a></li>
</ul>
</section>
</section>
</section>
<section id="task-define-and-use-an-index-template-for-a-given-pattern-that-satisfies-a-given-set-of-requirements" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="task-define-and-use-an-index-template-for-a-given-pattern-that-satisfies-a-given-set-of-requirements"><span class="header-section-number">1.2</span> Task: Define and use an index template for a given pattern that satisfies a given set of requirements</h2>
<section id="example-1-creating-an-index-template-for-a-user-profile-data" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-1-creating-an-index-template-for-a-user-profile-data">Example 1: Creating an index template for a user profile data</h3>
<section id="requirements-3" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-3">Requirements</h4>
<ul>
<li>Create an index template named <code>user_profile_template</code>.</li>
<li>The template should apply to indices starting with <code>user_profile-</code>.</li>
<li>The template should have two shards and one replica.</li>
<li>The template should have a mapping for the <code>name</code> field as a <code>text</code> data type with an analyzer of <code>standard</code>.</li>
<li>The template should have a mapping for the <code>age</code> field as an <code>integer</code> data type.</li>
</ul>
</section>
<section id="steps-3" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-3">Steps</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create the index template</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_index_template/user_profile_template</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"user_profile-*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"number_of_shards"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"number_of_replicas"</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"name"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span><span class="fu">,</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="st">"standard"</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"age"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-3" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-3">Test</h4>
<ol type="1">
<li><p>Verify the index template was created</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">_index_template/user_profile_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create an index named <code>user_profile-2024</code> using the REST API:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/user_profile_2024</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify that the index was created with the expected settings and mappings:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/user_profile_2024/_settings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/user_profile_2024/_mapping</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="considerations-3" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-3">Considerations</h4>
<ul>
<li>Two shards are chosen to allow for parallel processing and improved search performance.</li>
<li>One replica is chosen for simplicity and development purposes; in a production environment, this would depend on the expected data volume and search traffic.</li>
<li>The <code>standard</code> analyzer is chosen for the <code>name</code> field to enable standard text analysis.</li>
</ul>
</section>
<section id="clean-up-optional-3" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-3">Clean-up (optional)</h4>
<ul>
<li><p>In the console execute the following</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/user_profile_2024</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_index_template/user_profile_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-3" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-3">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/analyzer.html" target="_blank">Analyzers</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-create-index.html" target="_blank">Create Index API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/index-templates.html" target="_blank">Index templates</a></li>
</ul>
</section>
</section>
<section id="example-2-creating-a-monthly-product-index-template" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-2-creating-a-monthly-product-index-template">Example 2: Creating a monthly product index template</h3>
<section id="requirements-4" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-4">Requirements</h4>
<ul>
<li>Index name pattern: <code>products-*</code></li>
<li>Index settings:
<ul>
<li>Number of shards: 3</li>
<li>Number of replicas: 2</li>
</ul></li>
<li>Mapping:
<ul>
<li>Field <code>name</code> should be of type <code>text</code></li>
<li>Field <code>description</code> should be of type <code>text</code></li>
<li>Field <code>price</code> should be of type <code>float</code></li>
<li>Field <code>category</code> should be of type <code>keyword</code></li>
</ul></li>
</ul>
</section>
<section id="steps-4" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-4">Steps</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create the index template</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">_template/monthly_products</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"products-*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"number_of_shards"</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"number_of_replicas"</span><span class="fu">:</span> <span class="dv">2</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"name"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"description"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"price"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"float"</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"category"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-4" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-4">Test</h4>
<ol type="1">
<li><p>Verify the index template was created</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">_index_template/monthly_products</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create a new index matching the pattern (e.g., <strong>products-202305</strong>):</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">products-202305</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify that the index was created with the expected settings and mappings:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/products-202305/_settings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/products-202305/_mapping</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Index a sample document and verify that the mapping is applied correctly:</p>
<ol type="1">
<li><p>Index</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">products-202305/_doc</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Product A"</span><span class="fu">,</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"This is a sample product"</span><span class="fu">,</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"price"</span><span class="fu">:</span> <span class="fl">19.99</span><span class="fu">,</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"category"</span><span class="fu">:</span> <span class="st">"Electronics"</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Search</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">products-202305/_search</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol></li>
</ol>
<p>The response should show the correct mapping for the fields specified in the index template.</p>
</section>
<section id="considerations-4" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-4">Considerations</h4>
<ul>
<li>The <code>index_patterns</code> field specifies the pattern for index names to which this template should be applied.</li>
<li>The <code>number_of_shards</code> and <code>number_of_replicas</code> settings are chosen based on the expected data volume and high availability requirements.</li>
<li>The <code>text</code> type is used for <code>name</code> and <code>description</code> fields to enable full-text search and analysis.</li>
<li>The <code>float</code> type is used for the <code>price</code> field to support decimal values.</li>
<li>The <code>keyword</code> type is used for the <code>category</code> field to prevent analysis and treat the values as exact matches.</li>
</ul>
</section>
<section id="clean-up-optional-4" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-4">Clean-up (optional)</h4>
<ul>
<li><p>In the console execute the following</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">products-202305</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">_template/monthly_products</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-4" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-4">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-create-index.html" target="_blank">Create Index API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/index-templates.html" target="_blank">Index templates</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/search-search.html" target="_blank">Search API</a></li>
</ul>
</section>
</section>
<section id="example-3-creating-an-index-template-for-log-indices" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-3-creating-an-index-template-for-log-indices">Example 3: Creating an index template for log indices</h3>
<section id="requirements-5" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-5">Requirements</h4>
<ul>
<li>The template should apply to any index starting with <code>logs-</code>.</li>
<li>The template must define settings for three primary shards and one replica.</li>
<li>The template should include mappings for fields <code>@timestamp</code>, <code>log_level</code>, and <code>message</code>.</li>
</ul>
</section>
<section id="steps-5" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-5">Steps</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create the index template</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_index_template/logs_template</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"logs-*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"number_of_shards"</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"number_of_replicas"</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"@timestamp"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"date"</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"log_level"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"message"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-5" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-5">Test</h4>
<ol type="1">
<li><p>Verify the index template was created</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">_index_template/logs_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create a new index matching the pattern (e.g., <strong>logs-202405</strong>)</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">logs-202405</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify that the index was created with the expected settings and mappings</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/logs-202405/_settings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/logs-202405/_mapping</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Index a sample document and verify that the mapping is applied correctly:</p>
<ol type="1">
<li><p>Index</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">logs-202405/_doc</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"@timestamp"</span><span class="fu">:</span> <span class="st">"2024-05-16T12:34:56Z"</span><span class="fu">,</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"log_level"</span><span class="fu">:</span> <span class="st">"ERROR"</span><span class="fu">,</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"message"</span><span class="fu">:</span> <span class="st">"Help!"</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Search</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">logs-202405/_search</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol></li>
</ol>
<p>The response should show the correct mapping for the fields specified in the index template.</p>
</section>
<section id="considerations-5" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-5">Considerations</h4>
<ul>
<li><strong>Index Patterns:</strong> The template applies to any index starting with <code>logs-</code>, ensuring consistency across similar indices.</li>
<li><strong>Number of Shards:</strong> Three shards provide a balance between performance and resource utilization.</li>
<li><strong>Replicas:</strong> A single replica ensures high availability and fault tolerance.</li>
<li><strong>Mappings:</strong> Predefined mappings ensure that the fields are properly indexed and can be efficiently queried.</li>
</ul>
</section>
<section id="clean-up-optional-5" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-5">Clean-up (optional)</h4>
<ul>
<li><p>In the console execute the following</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">logs-202405</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">_index_template/logs_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-5" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-5">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-create-index.html" target="_blank">Create Index API</a></li>
<li><a href="https://www.elastic.co/guide/en/logstash/8.13/event-dependent-configuration.html" target="_blank">Logstash: Event Dependent Configuration</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/index-templates.html" target="_blank">Index templates</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/search-search.html" target="_blank">Search API</a></li>
</ul>
</section>
</section>
</section>
<section id="task-define-and-use-a-dynamic-template-that-satisfies-a-given-set-of-requirements" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="task-define-and-use-a-dynamic-template-that-satisfies-a-given-set-of-requirements"><span class="header-section-number">1.3</span> Task: Define and use a dynamic template that satisfies a given set of requirements</h2>
<p>FYI: The difference between <strong>index templates</strong> and <strong>dynamic templates</strong> is:</p>
<p><em>An <strong>index template</strong> is a way to define settings, mappings, and other configurations that should be applied automatically to new indices when they are created. </em> A <strong>dynamic template</strong> is part of the mapping definition within an index template or index mapping that allows Elasticsearch to dynamically infer the mapping of fields based on field names, data patterns, or the data type detected.</p>
<p>There is one example per field mapping type. They all use an explicit dynamic template, but Exercise 1 also shows the use of a dynamic template embedded in the index definition.</p>
<section id="example-1-create-a-dynamic-template-for-logging-using-field-name-patterns" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-1-create-a-dynamic-template-for-logging-using-field-name-patterns">Example 1: Create a Dynamic Template for Logging Using Field Name Patterns</h3>
<section id="requirements-6" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-6">Requirements</h4>
<ul>
<li>Apply a specific text analysis to all fields that end with <code>_log</code>.</li>
<li>Use a <code>keyword</code> type for all fields that start with <code>status_</code>.</li>
<li>Default to <code>text</code> with a standard analyzer for other string fields.</li>
<li>Define a custom <code>log_analyzer</code> for <code>_log</code> fields.</li>
</ul>
</section>
<section id="steps-6" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-6">Steps</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Define the dynamic template</p></li>
</ol>
<ul>
<li><p>As part of the index definition</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/logs_index</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"dynamic_templates"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"log_fields"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"match"</span><span class="fu">:</span> <span class="st">"*_log"</span><span class="fu">,</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span><span class="fu">,</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="st">"log_analyzer"</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"status_fields"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"match"</span><span class="fu">:</span> <span class="st">"status_*"</span><span class="fu">,</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"default_string"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"match_mapping_type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span><span class="fu">,</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="st">"standard"</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"analysis"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"log_analyzer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"custom"</span><span class="fu">,</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"tokenizer"</span><span class="fu">:</span> <span class="st">"standard"</span><span class="fu">,</span></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"filter"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"lowercase"</span><span class="ot">,</span> <span class="st">"stop"</span><span class="ot">]</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>or as a standalone definition to be added to indexes as needed using the index_pattern</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_index_template/logs_dyn_template</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"logs_*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"dynamic_templates"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"log_fields"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"match"</span><span class="fu">:</span> <span class="st">"*_log"</span><span class="fu">,</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span><span class="fu">,</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="st">"log_analyzer"</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"status_fields"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"match"</span><span class="fu">:</span> <span class="st">"status_*"</span><span class="fu">,</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"default_string"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"match_mapping_type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span><span class="fu">,</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="st">"standard"</span></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span></span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"analysis"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"log_analyzer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"custom"</span><span class="fu">,</span></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"tokenizer"</span><span class="fu">:</span> <span class="st">"standard"</span><span class="fu">,</span></span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"filter"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"lowercase"</span><span class="ot">,</span> <span class="st">"stop"</span><span class="ot">]</span></span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="test-6" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-6">Test</h4>
<ol type="1">
<li><p>Verify the dynamic template was created</p>
<ul>
<li>If you used the embedded version</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/logs_index/_mapping</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>If you used the standalone version</li>
</ul>
<div class="sourceCode" id="cb55"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_index_template/logs_dyn_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create a new index matching the pattern (e.g., logs-202405)</p>
<ul>
<li>Optional if you used the embedded version</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">logs_index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify that the created index has the expected settings and mappings</p>
<ul>
<li>Ensure error_log is of type text with log_analyzer</li>
<li>Ensure status_code is of type keyword</li>
<li>Ensure message is of type text with standard analyzer</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/logs_index/_mapping</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Index a sample document and verify that the mapping is applied correctly</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">/logs_index/_doc/1</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"error_log"</span><span class="fu">:</span> <span class="st">"This is an error log message."</span><span class="fu">,</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"status_code"</span><span class="fu">:</span> <span class="st">"200"</span><span class="fu">,</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"message"</span><span class="fu">:</span> <span class="st">"Regular log message."</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Perform Searches:</p>
<ul>
<li>Search within error_log and verify the custom analyzer is applied</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/logs_index/_search</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"query"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"match"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"error_log"</span><span class="fu">:</span> <span class="st">"error"</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Check if status_code is searchable as a keyword</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/logs_index/_search</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"query"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"term"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"status_code"</span><span class="fu">:</span> <span class="st">"200"</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="considerations-6" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-6">Considerations</h4>
<ul>
<li>The custom analyzer log_analyzer is used to provide specific tokenization and filtering for log fields.</li>
<li>The keyword type for status_* fields ensures they are treated as exact values, useful for status codes.</li>
<li>The default_string template ensures other string fields are analyzed with the standard analyzer, providing a balanced default.</li>
</ul>
</section>
<section id="clean-up-optional-6" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-6">Clean-up (optional)</h4>
<ul>
<li><p>Delete the index</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">logs_index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the dynamic template</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_index_template/logs_dyn_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-6" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-6">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic-templates.html" target="_blank">Dynamic Templates</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-custom-analyzer.html" target="_blank">Custom Analyzers</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html" target="_blank">Put Mapping API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html" target="_blank">Index API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-search.html" target="_blank">Search API</a></li>
</ul>
</section>
</section>
<section id="example-2-create-dynamic-template-for-data-types" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-2-create-dynamic-template-for-data-types">Example 2: Create Dynamic Template for Data Types</h3>
<section id="requirements-7" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-7">Requirements</h4>
<ul>
<li>All string fields should be treated as <code>text</code> with a <code>standard</code> analyzer.</li>
<li>All long fields should be treated as <code>integer</code>.</li>
<li>All <code>date</code> fields should use a specific date format.</li>
</ul>
</section>
<section id="steps-7" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-7">Steps</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Define the Dynamic Template</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_index_template/data_type_template</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"data_type_*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"dynamic_templates"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"strings_as_text"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"match_mapping_type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span><span class="fu">,</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="st">"standard"</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"longs_as_integer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"match_mapping_type"</span><span class="fu">:</span> <span class="st">"long"</span><span class="fu">,</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"integer"</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"dates_with_format"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"match_mapping_type"</span><span class="fu">:</span> <span class="st">"date"</span><span class="fu">,</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"date"</span><span class="fu">,</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"format"</span><span class="fu">:</span> <span class="st">"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-7" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-7">Test</h4>
<ol type="1">
<li><p>Verify the dynamic template was created</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_index_template/data_type_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create a new index matching the pattern</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">data_type_202405</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Check the Field Types</p>
<ul>
<li>Verify that all string fields are mapped as <code>text</code> with the <code>standard</code> analyzer.</li>
<li>Verify that all long fields are mapped as <code>integer</code>.</li>
<li>Verify that all <code>date</code> fields are mapped with the correct format.</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/data_type_202405/_mapping</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Insert sample documents to ensure that the dynamic template is applied correctly</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">/data_type_202405/_bulk</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">"data_type_202405"</span><span class="fu">,</span> <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"1"</span> <span class="fu">}</span> <span class="fu">}</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Wireless Bluetooth Headphones"</span><span class="fu">,</span> <span class="dt">"release_date"</span><span class="fu">:</span> <span class="st">"2024-05-28T14:35:00.000Z"</span><span class="fu">,</span> <span class="dt">"price"</span><span class="fu">:</span> <span class="dv">99</span> <span class="fu">}</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">"data_type_202405"</span><span class="fu">,</span> <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"2"</span> <span class="fu">}</span> <span class="fu">}</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Durable stainless steel water bottle"</span><span class="fu">,</span> <span class="dt">"launch_date"</span><span class="fu">:</span> <span class="st">"2024-05-28T15:00:00.000Z"</span><span class="fu">,</span> <span class="dt">"quantity"</span><span class="fu">:</span> <span class="dv">500</span> <span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Perform Searches</p>
<ul>
<li>Search launch_date</li>
</ul>
<div class="sourceCode" id="cb68"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/data_type_202405/_search</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"query"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"query_string"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"query"</span><span class="fu">:</span> <span class="st">"launch_date:</span><span class="ch">\"</span><span class="st">2024-05-28T15:00:00.000Z</span><span class="ch">\"</span><span class="st">"</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Check if price is searchable as a value</li>
</ul>
<div class="sourceCode" id="cb69"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/data_type_202405/_search</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"query"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"query_string"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"query"</span><span class="fu">:</span> <span class="st">"price: 99"</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="considerations-7" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-7">Considerations</h4>
<ul>
<li><strong>Dynamic Templates:</strong> Using dynamic templates based on data types allows for flexible and consistent field mappings without needing to know the exact field names in advance.</li>
<li><strong>Data Types:</strong> Matching on data types (string, long, date) ensures that fields are mapped appropriately based on their content.</li>
<li><strong>Date Format:</strong> Specifying the date format ensures that date fields are parsed correctly, avoiding potential issues with date-time representation.</li>
</ul>
</section>
<section id="clean-up-optional-7" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-7">Clean-up (optional)</h4>
<ul>
<li><p>Delete the index</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">data_type_202405</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the dynamic template</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_index_template/data_type_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-7" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-7">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic-templates.html" target="_blank">Dynamic Templates</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html" target="_blank">Mapping</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analyzer.html" target="_blank">Analyzers</a></li>
</ul>
</section>
</section>
<section id="example-3-create-a-dynamic-template-for-logging-data-for-data-patterns" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-3-create-a-dynamic-template-for-logging-data-for-data-patterns">Example 3: Create a Dynamic Template for Logging Data for Data Patterns</h3>
<section id="requirements-8" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-8">Requirements</h4>
<ul>
<li>Automatically map fields that end with “_ip” as IP type.</li>
<li>Map fields that start with “timestamp_” as date type.</li>
<li>Map any field containing the word “keyword” as a keyword type.</li>
<li>Use a custom analyzer for fields ending with “_text”.</li>
</ul>
</section>
<section id="steps-8" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-8">Steps</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create the dynamic template</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_index_template/logs_template</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"logs*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"analysis"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"custom_analyzer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"standard"</span><span class="fu">,</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"stopwords"</span><span class="fu">:</span> <span class="st">"_english_"</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"dynamic_templates"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"ip_fields"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"match"</span><span class="fu">:</span> <span class="st">"*_ip"</span><span class="fu">,</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"ip"</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"date_fields"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"match"</span><span class="fu">:</span> <span class="st">"timestamp_*"</span><span class="fu">,</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"date"</span></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"keyword_fields"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"match"</span><span class="fu">:</span> <span class="st">"*keyword*"</span><span class="fu">,</span></span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span></span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"text_fields"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"match"</span><span class="fu">:</span> <span class="st">"*_text"</span><span class="fu">,</span></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"mapping"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span><span class="fu">,</span></span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"analyzer"</span><span class="fu">:</span> <span class="st">"custom_analyzer"</span></span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span></span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-8" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-8">Test</h4>
<ol type="1">
<li><p>Verify the dynamic template was created</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_index_template/logs_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create a new index matching the pattern</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">logs_202405</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Check the Field Types</p>
<ul>
<li>Verify that all <code>_ip</code> fields are mapped as <code>ip</code></li>
<li>Verify that all <code>timestamp_</code> fields are mapped as <code>date</code></li>
<li>Verify that all fields that contain the string keyword are mapped as <code>keyword</code></li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/logs_202405/_mapping</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Insert sample documents to ensure that the dynamic template is applied correctly</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">/logs_202405/_bulk</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"1"</span> <span class="fu">}</span> <span class="fu">}</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"source_ip"</span><span class="fu">:</span> <span class="st">"192.168.1.1"</span><span class="fu">,</span> <span class="dt">"timestamp_event"</span><span class="fu">:</span> <span class="st">"2024-05-28T12:00:00Z"</span><span class="fu">,</span> <span class="dt">"user_keyword"</span><span class="fu">:</span> <span class="st">"elastic"</span><span class="fu">,</span> <span class="dt">"description_text"</span><span class="fu">:</span> <span class="st">"This is a log entry."</span> <span class="fu">}</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"2"</span> <span class="fu">}</span> <span class="fu">}</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"destination_ip"</span><span class="fu">:</span> <span class="st">"10.0.0.1"</span><span class="fu">,</span> <span class="dt">"timestamp_access"</span><span class="fu">:</span> <span class="st">"2024-05-28T12:05:00Z"</span><span class="fu">,</span> <span class="dt">"log_keyword"</span><span class="fu">:</span> <span class="st">"search"</span><span class="fu">,</span> <span class="dt">"details_text"</span><span class="fu">:</span> <span class="st">"Another log entry."</span> <span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Perform Searches</p>
<ul>
<li>Search source_ip</li>
</ul>
<div class="sourceCode" id="cb77"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/logs_202405/_search</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"query"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"query_string"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"query"</span><span class="fu">:</span> <span class="st">"source_ip:</span><span class="ch">\"</span><span class="st">192.168.1.1</span><span class="ch">\"</span><span class="st">"</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Check if timestamp_event is searchable as a date</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/logs_202405/_search</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"query"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"query_string"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"query"</span><span class="fu">:</span> <span class="st">"timestamp_event:</span><span class="ch">\"</span><span class="st">2024-05-28T12:00:00Z</span><span class="ch">\"</span><span class="st">"</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="considerations-8" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-8">Considerations</h4>
<ul>
<li>The use of patterns in the dynamic template ensures that newly added fields matching the criteria are automatically mapped without the need for manual intervention.</li>
<li>Custom analyzer configuration is critical for ensuring text fields are processed correctly, enhancing search capabilities.</li>
</ul>
</section>
<section id="clean-up-optional-8" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-8">Clean-up (optional)</h4>
<ul>
<li><p>Delete the index</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">logs_202405</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the dynamic template</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_index_template/logs_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-8" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-8">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic-templates.html" target="_blank">Dynamic Templates</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html" target="_blank">Mapping Types</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-analyzers.html" target="_blank">Analyzers</a></li>
</ul>
</section>
</section>
</section>
<section id="task-define-an-index-lifecycle-management-policy-for-a-timeseries-index" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="task-define-an-index-lifecycle-management-policy-for-a-timeseries-index"><span class="header-section-number">1.4</span> Task: Define an Index Lifecycle Management policy for a timeseries index</h2>
<section id="example-1-creating-an-ilm-policy-for-log-data-indices" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-1-creating-an-ilm-policy-for-log-data-indices">Example 1: Creating an ILM policy for log data indices</h3>
<section id="requirements-9" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-9">Requirements</h4>
<ul>
<li>Indices are prefixed with <code>logstash-</code></li>
<li>Indices should be rolled over daily (create a new index every day).</li>
<li>Old indices should be deleted after 30 days.</li>
</ul>
</section>
<section id="steps-using-the-elastickibana-ui" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-using-the-elastickibana-ui">Steps using the Elastic/Kibana UI</h4>
<ol type="1">
<li><p>Open the hamburger menu and click on <strong>Management &gt; Data &gt; Life Cycle Policies</strong>.</p></li>
<li><p>Press <strong>+ Create New Policy</strong>.</p></li>
<li><p>Enter the following:</p>
<ul>
<li>Policy name: logstash-example-policy.</li>
<li><strong>Hot</strong> phase:
<ul>
<li>Change <strong>Keep Data in the Phase Forever</strong> (the infinity icon) to <strong>Delete Data After This Phase</strong> (the trashcan icon).</li>
<li>Click <strong>Advanced Settings</strong>.</li>
<li>Unselect <strong>Use Recommended Defaults</strong>.</li>
<li>Set <strong>Maximum Age</strong> to <strong>1</strong>.</li>
</ul></li>
<li><strong>Delete</strong> phase:
<ul>
<li>Move data into phase when: 30 days old.</li>
</ul></li>
</ul></li>
<li><p>Press <strong>Save Policy</strong>.</p></li>
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create an index template that will match on indices that match the pattern <code>logstash-*</code>.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_index_template/ilm_logstash_index_template</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"logstash-*"</span><span class="ot">]</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Return to the <strong>Management &gt; Data &gt; Life Cycle Policies</strong> page.</p></li>
<li><p>Press the plus sign (+) to the right of logstash-example-policy.</p>
<ol type="1">
<li>The <strong>Add Policy “logstash-example-policy” to index template</strong> dialog opens.</li>
<li>Click on the <strong>Index Template</strong> input field and type the first few letters of the index template created above.</li>
<li>Select the template created above (ilm_logstash_index_template).</li>
<li>Press <strong>Add Policy</strong>.</li>
</ol></li>
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>List <code>ilm_logs_index_template</code>. Notice the ILM policy is now part of the index template.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_index_template/ilm_logstash_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Output from the <code>GET</code>:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_templates"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"ilm_logstash_index_template"</span><span class="fu">,</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"index_template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"logstash-*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"lifecycle"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>                <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"logstash-example-policy"</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">}</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"composed_of"</span><span class="fu">:</span> <span class="ot">[]</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create an index.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">logstash-2024.05.16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify the policy is there.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">logstash-2024.05.16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The output should look something like this:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"logstash-2024.05.16"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"aliases"</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"lifecycle"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"logstash-example-policy"</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"routing"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"allocation"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"include"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"_tier_preference"</span><span class="fu">:</span> <span class="st">"data_content"</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"number_of_shards"</span><span class="fu">:</span> <span class="st">"1"</span><span class="fu">,</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"provided_name"</span><span class="fu">:</span> <span class="st">"logstash-2024.05.16"</span><span class="fu">,</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"creation_date"</span><span class="fu">:</span> <span class="st">"1717024100387"</span><span class="fu">,</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"priority"</span><span class="fu">:</span> <span class="st">"100"</span><span class="fu">,</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"number_of_replicas"</span><span class="fu">:</span> <span class="st">"1"</span><span class="fu">,</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"uuid"</span><span class="fu">:</span> <span class="st">"mslAKuZGTpSDdFr4hSpAAA"</span><span class="fu">,</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"version"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"created"</span><span class="fu">:</span> <span class="st">"8503000"</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="steps-using-the-rest-api-which-i-would-not-recommend" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-using-the-rest-api-which-i-would-not-recommend">Steps Using the REST API (which I would not recommend)</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create the ILM policy.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">_ilm/policy/logstash-example-policy</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"policy"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"phases"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"hot"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"rollover"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"max_age"</span><span class="fu">:</span> <span class="st">"1d"</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"delete"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"min_age"</span><span class="fu">:</span> <span class="st">"30d"</span><span class="fu">,</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"delete"</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create an index template that includes the above policy. The two fields within settings are required.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_index_template/ilm_logstash_index_template</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"logstash-*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"index.lifecycle.name"</span><span class="fu">:</span> <span class="st">"logstash-example-policy"</span><span class="fu">,</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"index.lifecycle.rollover_alias"</span><span class="fu">:</span> <span class="st">"logstash"</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-9" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-9">Test</h4>
<ol type="1">
<li><p>Verify the ILM policy exists in Kibana under <strong>Management &gt; Data &gt; Index Lifecycle Policies</strong>.</p></li>
<li><p>Verify the Index Lifecycle Management policy exists and references the index template.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_ilm/policy/logstash-example-policy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify the policy is referenced in the index template.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_index_template/ilm_logstash_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create a new index that matches the pattern logstash-*.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/logstash-index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify the index has the policy in its definition.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/logstash-index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="considerations-9" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-9">Considerations</h4>
<ul>
<li>The index template configures 1 shard and the ILM policy/alias for rollover.</li>
<li>The rollover action creates a new index when the max_age is reached.</li>
<li>The delete phase removes indices older than 30 days.</li>
</ul>
</section>
<section id="clean-up-optional-9" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-9">Clean-up (optional)</h4>
<ul>
<li><p>Delete the index.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">logstash-index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the index template.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_index_template/ilm_logstash_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the policy.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_ilm/policy/logstash-example-policy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-9" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-9">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-create-index.html" target="_blank">Create Index API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-put-template.html" target="_blank">Create or Update Index Template API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/ilm-settings.html" target="_blank">ILM Settings</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/ilm-index-lifecycle.html" target="_blank">Index Lifecycle Management</a></li>
</ul>
</section>
</section>
<section id="example-2-creating-an-ilm-policy-for-logs-indices-retention-for-7-30-and-90-days" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-2-creating-an-ilm-policy-for-logs-indices-retention-for-7-30-and-90-days">Example 2: Creating an ILM policy for logs indices retention for 7, 30 and 90 days</h3>
<section id="requirements-10" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-10">Requirements</h4>
<ul>
<li>The policy should be named <code>logs-policy</code>.</li>
<li>It should have a hot phase with a duration of 7 days.</li>
<li>It should have a warm phase with a duration of 30 days.</li>
<li>It should have a cold phase with a duration of 90 days.</li>
<li>It should have a delete phase.</li>
<li>The policy should be assigned to indices matching the pattern <code>ilm_logs_*</code>.</li>
</ul>
<p><strong><em>Steps using the Elastic/Kibana UI</em></strong></p>
<ol type="1">
<li><p>Open the hamburger menu and click on <strong>Management &gt; Data &gt; Life Cycle Policies</strong>.</p></li>
<li><p>Press <strong>+ Create New Policy</strong>.</p></li>
<li><p>Enter the following:</p>
<ul>
<li>Policy name: logs-policy.</li>
<li><strong>Hot</strong> phase:
<ul>
<li>Press the garbage can icon to the right to <strong>delete data after this phase</strong>.</li>
</ul></li>
<li><strong>Warm</strong> phase:
<ul>
<li>Move data into phase when: 7 days old.</li>
<li>Leave <strong>Delete data after this phase</strong>.</li>
</ul></li>
<li><strong>Cold</strong> phase:
<ul>
<li>Move data into phase when: 30 days old.</li>
<li>Leave <strong>Delete data after this phase</strong>.</li>
</ul></li>
<li><strong>Delete</strong> phase:
<ul>
<li>Move data into phase when: 90 days old.</li>
</ul></li>
</ul></li>
<li><p>Press <strong>Save Policy</strong>.</p></li>
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create an index template that will match on indices that match the pattern <code>ilm_logs_*</code>.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_index_template/ilm_logs_index_template</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"ilm_logs_*"</span><span class="ot">]</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Return to the <strong>Management &gt; Data &gt; Life Cycle Policies</strong> page.</p></li>
<li><p>Press the plus sign (+) to the right of logs_policy.</p></li>
<li><p>The <strong>Add Policy “logs-policy” to index template</strong> dialog opens.</p></li>
<li><p>Click on the <strong>Index Template</strong> input field and type the first few letters of the index template created above.</p></li>
<li><p>Select the template created above (<code>ilm_logs_index_template</code>).</p></li>
<li><p>Press <strong>Add Policy</strong>.</p></li>
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>List <code>ilm_logs_index_template</code>. Notice the ILM policy is now part of the index template.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_index_template/ilm_logs_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Output from the <code>GET</code> (look for the <strong>settings/index/lifecycle</strong> node):</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_templates"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"ilm_logs_index_template"</span><span class="fu">,</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"index_template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"ilm_logs_*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"lifecycle"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>                <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"logs-policy"</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">}</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"composed_of"</span><span class="fu">:</span> <span class="ot">[]</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>List <code>logs-policy</code>.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">_ilm/policy/logs-policy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the <code>in_use_by</code> node you will see:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="er">"in_use_by":</span> <span class="fu">{</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"indices"</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"data_streams"</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"composable_templates"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ilm_logs_index_template"</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="steps-using-the-rest-api-which-i-would-not-recommend-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-using-the-rest-api-which-i-would-not-recommend-1">Steps Using the REST API (which I would not recommend)</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create the ILM policy.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">_ilm/policy/logs-policy</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"policy"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"phases"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"hot"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"min_age"</span><span class="fu">:</span> <span class="st">"0ms"</span><span class="fu">,</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"set_priority"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"priority"</span><span class="fu">:</span> <span class="dv">100</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"warm"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"min_age"</span><span class="fu">:</span> <span class="st">"7d"</span><span class="fu">,</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"set_priority"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"priority"</span><span class="fu">:</span> <span class="dv">50</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"cold"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"min_age"</span><span class="fu">:</span> <span class="st">"30d"</span><span class="fu">,</span></span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"set_priority"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"priority"</span><span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"delete"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"min_age"</span><span class="fu">:</span> <span class="st">"90d"</span><span class="fu">,</span></span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"delete"</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Assign the policy to the indices matching the pattern “logs_*“.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_index_template/ilm_logs_index_template</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"ilm_logs_*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"index.lifecycle.name"</span><span class="fu">:</span> <span class="st">"logs-policy"</span><span class="fu">,</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"index.lifecycle.rollover_alias"</span><span class="fu">:</span> <span class="st">"logs"</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-10" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-10">Test</h4>
<ol type="1">
<li><p>Verify the ILM policy exists in Kibana under <strong>Management &gt; Data &gt; Index Lifecycle Policies</strong>.</p></li>
<li><p>Verify the Index Lifecycle Management policy exists and references the index template.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_ilm/policy/logs-policy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify the policy is referenced in the index template.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_index_template/ilm_logs_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create a new index that matches the pattern <code>ilm_logs_*</code>.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/ilm_logs_index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify the index has the policy in its definition.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/ilm_logs_index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="considerations-10" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-10">Considerations</h4>
<ul>
<li>The ILM policy will manage the indices matching the pattern <code>ilm_logs_*</code>.</li>
<li>The hot phase will keep the data for <strong>7</strong> days with high priority and rollover.</li>
<li>The warm phase will keep the data for <strong>30</strong> days with medium priority.</li>
<li>The cold phase will keep the data for <strong>90</strong> days with low priority.</li>
<li>The ILM policy will automatically manage the indices based on their age and size.</li>
<li>The policy can be adjusted based on the needs of the application and the data.</li>
</ul>
</section>
<section id="clean-up-optional-10" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-10">Clean-up (optional)</h4>
<ul>
<li><p>Delete the index.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">ilm_logs_index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the index template.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">_index_template/ilm_logs_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the policy.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">_ilm/policy/logs-policy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-10" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-10">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-create-index.html" target="_blank">Create Index API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-put-template.html" target="_blank">Create or Update Index Template API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/ilm-settings.html" target="_blank">ILM Settings</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/ilm-index-lifecycle.html" target="_blank">Index Lifecycle Management</a></li>
</ul>
</section>
</section>
<section id="example-3-creating-an-ilm-policy-for-sensor-data-collected-every-hour-with-daily-rollover-and-retention-for-one-month" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-3-creating-an-ilm-policy-for-sensor-data-collected-every-hour-with-daily-rollover-and-retention-for-one-month">Example 3: Creating an ILM policy for sensor data collected every hour, with daily rollover and retention for one month</h3>
<section id="requirements-11" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-11">Requirements</h4>
<ul>
<li>Create a new index every day for sensor data (e.g., <code>sensor_data-{date}</code>).</li>
<li>Automatically roll over to a new index when the current one reaches a specific size.</li>
<li>Delete rolled over indices after one month.</li>
</ul>
<p><strong><em>Steps using the Elastic/Kibana UI</em></strong></p>
<ol type="1">
<li><p>Open the hamburger menu and click on <strong>Management &gt; Data &gt; Life Cycle Policies</strong>.</p></li>
<li><p>Press <strong>+ Create New Policy</strong>.</p></li>
<li><p>Enter the following:</p>
<ol type="1">
<li><p>Policy name: <strong>sensor-data-policy</strong></p></li>
<li><p><strong>Hot</strong> phase:</p>
<ol type="1">
<li>Change <strong>Keep Data in the Phase Forever</strong> (the infinity icon) to <strong>Delete Data After This Phase</strong> (the trashcan icon).</li>
<li>Click <strong>Advanced Settings</strong>.</li>
<li>Unselect <strong>Use Recommended Defaults</strong>.</li>
<li>Set <strong>Maximum Age</strong> to <strong>1</strong>.</li>
<li>Set <strong>Maximum Index Size</strong> to <strong>10</strong>.</li>
</ol></li>
<li><p><strong>Delete</strong> phase:</p>
<ol type="1">
<li>Move data into phase when: <strong>30</strong> days old.</li>
</ol></li>
</ol></li>
<li><p>Press <strong>Save Policy</strong>.</p></li>
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create an index template that will match on indices that match the pattern “sensor_data-*“.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_index_template/sensor_data_index_template</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"sensor_data-*"</span><span class="ot">]</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Return to the <strong>Management &gt; Data &gt; Life Cycle Policies</strong> page.</p></li>
<li><p>Press the plus sign (+) to the right of sensor-data-policy.</p></li>
<li><p>The <strong>Add Policy “sensor-data-policy” to index template</strong> dialog opens.</p>
<ol type="1">
<li>Click on the <strong>Index Template</strong> input field and type the first few letters of the index template created above.</li>
<li>Select the template created above (sensor_data_index_template).</li>
<li>Press <strong>Add Policy</strong>.</li>
</ol></li>
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>List sensor_data_index_template. Notice the ILM policy is now part of the index template.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_index_template/sensor_data_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Output from the <code>GET</code>:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_templates"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"sensor_data_index_template"</span><span class="fu">,</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"index_template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"sensor_data-*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"index"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>              <span class="dt">"lifecycle"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>                <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"sensor-data-policy"</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">}</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"composed_of"</span><span class="fu">:</span> <span class="ot">[]</span></span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>List sensor-data-policy.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_ilm/policy/sensor-data-policy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the <code>in_use_by</code> node you will see:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="er">"in_use_by":</span> <span class="fu">{</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"indices"</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"data_streams"</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"composable_templates"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sensor_data_index_template"</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
<p><strong>OR</strong></p>
</section>
<section id="steps-using-the-rest-api-which-i-would-not-recommend-2" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-using-the-rest-api-which-i-would-not-recommend-2">Steps Using the REST API (which I would not recommend)</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Define the ILM policy.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">_ilm/policy/sensor-data-policy</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"policy"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"phases"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"hot"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"min_age"</span><span class="fu">:</span> <span class="st">"0ms"</span><span class="fu">,</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"rollover"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"max_age"</span><span class="fu">:</span> <span class="st">"1d"</span><span class="fu">,</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"max_size"</span><span class="fu">:</span> <span class="st">"10gb"</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"delete"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"min_age"</span><span class="fu">:</span> <span class="st">"30d"</span><span class="fu">,</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"delete"</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Assign the policy to the indices matching the pattern “sensor_data-*“.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_index_template/sensor_data_index_template</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"sensor_data-*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"index.lifecycle.name"</span><span class="fu">:</span> <span class="st">"sensor-data-policy"</span><span class="fu">,</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"index.lifecycle.rollover_alias"</span><span class="fu">:</span> <span class="st">"sensor"</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-11" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-11">Test</h4>
<ol type="1">
<li><p>Verify the ILM policy exists in Kibana under <strong>Management &gt; Data &gt; Index Lifecycle Policies</strong>.</p></li>
<li><p>Verify the Index Lifecycle Management policy exists and references the index template.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_ilm/policy/sensor-data-policy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify the policy is referenced in the index template.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_index_template/sensor_data_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create a new index that matches the pattern sensor_data-*.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/sensor_data-20240516</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Verify the index has the policy in its definition.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/sensor_data-20240516</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="considerations-11" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-11">Considerations</h4>
<ul>
<li>The hot phase size threshold determines the frequency of rollovers.</li>
<li>The delete phase retention period defines how long rolled over data is stored.</li>
</ul>
</section>
<section id="clean-up-optional-11" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-11">Clean-up (optional)</h4>
<ol type="1">
<li><p>Delete the index.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">sensor_data-20240516</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the index template.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_index_template/sensor_data_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the policy.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_ilm/policy/sensor-data-policy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="documentation-11" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-11">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-create-index.html" target="_blank">Create Index API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/indices-put-template.html" target="_blank">Create or Update Index Template API</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/ilm-settings.html" target="_blank">ILM Settings</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/ilm-index-lifecycle.html" target="_blank">Index Lifecycle Management</a></li>
</ul>
</section>
</section>
</section>
<section id="task-define-an-index-template-that-creates-a-new-data-stream" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="task-define-an-index-template-that-creates-a-new-data-stream"><span class="header-section-number">1.5</span> Task: Define an index template that creates a new data stream</h2>
<p><strong>Data streams</strong> in Elasticsearch are used for managing time-series data such as logs, metrics, and events. They can handle large volumes of time-series data in an efficient and scalable manner.</p>
<p>An interesting aspect is that the creation of the data stream is pretty trivial. It normally looks like this in the index template that contains it:</p>
<pre><code>```json
...
  "data_stream" : {}
...
```</code></pre>
<p>Yep, that’s it. The defaults take care of most circumstances.</p>
<p>Also, the <code>data_stream</code> must be created in an index template as the <code>data_stream</code> needs backing indices. Those backing indices are created when an index is created that matches the pattern in <code>index_patterns</code> (basically, any index created using the index template acts as an alias to the actual backing indices created).</p>
<section id="example-1-creating-an-index-template-for-continuously-flowing-application-logs" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-1-creating-an-index-template-for-continuously-flowing-application-logs">Example 1: Creating an index template for continuously flowing application logs</h3>
<section id="requirements-12" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-12">Requirements</h4>
<ul>
<li>Create a new data stream named “app-logs” to store application logs.</li>
<li>Automatically create new backing indices within the data stream as needed.</li>
</ul>
</section>
<section id="steps-9" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-9">Steps</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Define the index template that will be used by the data stream to create new backing indices.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">_index_template/app_logs_index_template</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"app_logs*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"data_stream"</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-12" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-12">Test</h4>
<ol type="1">
<li><p>Verify the index template creation.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">_index_template/app_logs_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Confirm there are no indices named app_logs*.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_cat/indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Mock sending streaming data by just pushing a few documents to the stream. When sending documents using _bulk, they must use <strong>create</strong> instead of <strong>index</strong>. In addition, the documents must have a <code>@timestamp</code> field.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">app_logs/_bulk</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"create"</span><span class="fu">:{}</span> <span class="fu">}</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"@timestamp"</span><span class="fu">:</span> <span class="st">"2099-05-06T16:21:15.000Z"</span><span class="fu">,</span> <span class="dt">"message"</span><span class="fu">:</span> <span class="st">"192.0.2.42 - - [06/May/2099:16:21:15 +0000] </span><span class="ch">\"</span><span class="st">GET /images/bg.jpg HTTP/1.0</span><span class="ch">\"</span><span class="st"> 200 24736"</span> <span class="fu">}</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"create"</span><span class="fu">:{}</span> <span class="fu">}</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">"@timestamp"</span><span class="fu">:</span> <span class="st">"2099-05-06T16:25:42.000Z"</span><span class="fu">,</span> <span class="dt">"message"</span><span class="fu">:</span> <span class="st">"192.0.2.255 - - [06/May/2099:16:25:42 +0000] </span><span class="ch">\"</span><span class="st">GET /favicon.ico HTTP/1.0</span><span class="ch">\"</span><span class="st"> 200 3638"</span> <span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The response will list the name of the automatically created index, which will look something like this:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"errors"</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"took"</span><span class="fu">:</span> <span class="dv">8</span><span class="fu">,</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"items"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"create"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">".ds-app_logs-2099.05.06-000001"</span><span class="fu">,</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"OOazyo8BAvAOn4WaAfdD"</span><span class="fu">,</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_version"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"result"</span><span class="fu">:</span> <span class="st">"created"</span><span class="fu">,</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_shards"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"total"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"successful"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"failed"</span><span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_seq_no"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_primary_term"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"status"</span><span class="fu">:</span> <span class="dv">201</span></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"create"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">".ds-app_logs-2099.05.06-000001"</span><span class="fu">,</span></span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"Oeazyo8BAvAOn4WaAfdD"</span><span class="fu">,</span></span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_version"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"result"</span><span class="fu">:</span> <span class="st">"created"</span><span class="fu">,</span></span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_shards"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"total"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"successful"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"failed"</span><span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_seq_no"</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"_primary_term"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"status"</span><span class="fu">:</span> <span class="dv">201</span></span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb129-36"><a href="#cb129-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb129-37"><a href="#cb129-37" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb129-38"><a href="#cb129-38" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice the name of the index is <code>.ds-app_logs-2099.05.06-000001</code> (it will probably be slightly different for you).</p></li>
<li><p>Run:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_cat/indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
<p>You will see the new index listed. This is the backing index created by the data stream.</p>
<ol start="5" type="1">
<li><p>Check for the <strong>app_logs</strong> data stream under <strong>Management &gt; Data &gt; Index Management &gt; Data Streams</strong>.</p></li>
<li><p>Verify that the documents were indexed.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">app_logs/_search</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice in the results that <code>_index</code> has a different name than <code>app_logs</code>.</p>
<p>You can also run the following (using the backing index name your cluster created).</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">.ds-app_logs-2024.07.25-000001/_search</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="considerations-12" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-12">Considerations</h4>
<ul>
<li>Data streams provide a more efficient way to handle continuously flowing data compared to daily indices. They are created implicitly through the use of index templates, and you must use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html" target="_blank">_bulk API</a> when streaming data.</li>
<li>New backing indices are automatically created within the data stream as needed.</li>
<li>Lifecycle management policies can be applied to data streams for automatic deletion of older backing indices.</li>
</ul>
</section>
<section id="clean-up-optional-12" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-12">Clean-up (optional)</h4>
<ol type="1">
<li><p>Delete the data stream (deleting the data stream will also delete the backing index).</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_data_stream/app_logs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the index template.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">_index_template/app_logs_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="documentation-12" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-12">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-template.html" target="_blank">Index Templates</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/set-up-a-data-stream.html" target="_blank">Setting Up a Data Stream</a></li>
</ul>
</section>
</section>
<section id="example-2-creating-an-index-template-for-continuously-flowing-application-logs-with-defined-fields" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-2-creating-an-index-template-for-continuously-flowing-application-logs-with-defined-fields">Example 2: Creating an index template for continuously flowing application logs with defined fields</h3>
<section id="requirements-13" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-13">Requirements</h4>
<ul>
<li>The template should apply to any index matching the pattern <code>logs*</code>.</li>
<li>The template must create a data stream.</li>
<li>The template should define settings for two primary shards and one replica.</li>
<li>The template should include mappings for fields <code>@timestamp</code>, <code>log_level</code>, and <code>message</code>.</li>
</ul>
</section>
<section id="steps-10" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-10">Steps</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create the index template</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">_index_template/log_application_index_template</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"logs*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"data_stream"</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"number_of_shards"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"number_of_replicas"</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"@timestamp"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"date"</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"log_level"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span></span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"message"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"text"</span></span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-13" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-13">Test</h4>
<ul>
<li><p>Verify the index template creation</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">_index_template/log_application_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Confirm there are no indices named logs*</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_cat/indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Index documents into the data stream</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">/logs/_doc</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"@timestamp"</span><span class="fu">:</span> <span class="st">"2024-05-16T12:34:56"</span><span class="fu">,</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"log_level"</span><span class="fu">:</span> <span class="st">"info"</span><span class="fu">,</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"message"</span><span class="fu">:</span> <span class="st">"Test log message"</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will return a result with the name of the backing index</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">".ds-logs-2024.05.16-000001"</span><span class="fu">,</span> <span class="er">//</span> <span class="er">yours</span> <span class="er">will</span> <span class="er">be</span> <span class="er">different</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"PObWyo8BAvAOn4WaC_de"</span><span class="fu">,</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_version"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"result"</span><span class="fu">:</span> <span class="st">"created"</span><span class="fu">,</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_shards"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"total"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"successful"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"failed"</span><span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_seq_no"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_primary_term"</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Run</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_cat/indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The index will be listed.</p></li>
<li><p>Confirm the configuration of the backing index matches the index template (your backing index name will be different)</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">.ds-logs-2024.05.16-000001</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Run a search for the document that was indexed</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">.ds-logs-2024.05.16-000001/_search</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="considerations-13" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-13">Considerations</h4>
<ul>
<li>Data streams provide a more efficient way to handle continuously flowing data compared to daily indices. They are created implicitly through the use of index templates, and you must use the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html" target="_blank">_bulk API</a> when streaming data.</li>
<li>New backing indices are automatically <strong>created</strong> within the data stream as needed.</li>
<li>Lifecycle management policies can be applied to data streams for automatic deletion of older backing indices (not shown but there is an example at <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/set-up-a-data-stream.html">Set Up a Data Stream</a>).</li>
</ul>
</section>
<section id="clean-up-optional-13" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-13">Clean-up (optional)</h4>
<ul>
<li><p>Delete the data stream (deleting the data stream will also delete the backing index)</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">_data_stream/logs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the index template</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">_index_template/log_application_index_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-13" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-13">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-template.html" target="_blank">Index Templates</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.13/set-up-a-data-stream.html" target="_blank">Setting Up a Data Stream</a></li>
</ul>
</section>
</section>
<section id="example-3-creating-a-metrics-data-stream-for-application-performance-monitoring" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-3-creating-a-metrics-data-stream-for-application-performance-monitoring">Example 3: Creating a metrics data stream for application performance monitoring</h3>
<section id="requirements-14" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-14">Requirements</h4>
<ul>
<li>Create an index template named <code>metrics_template</code>.</li>
<li>The template should create a new data stream for indices named <code>metrics-{suffix}</code>.</li>
<li>The template should have one shard and one replica.</li>
<li>The template should have a mapping for the <code>metric</code> field as a <code>keyword</code> data type.</li>
<li>The template should have a mapping for the <code>value</code> field as a <code>float</code> data type.</li>
</ul>
</section>
<section id="steps-11" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-11">Steps</h4>
<ol type="1">
<li><p><strong>Open the Kibana Console</strong> or use a REST client.</p></li>
<li><p>Create the index template.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">_index_template/metrics_template</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"metrics-*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"data_stream"</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"template"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"settings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"number_of_shards"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"number_of_replicas"</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"mappings"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"metric"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"keyword"</span></span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"value"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"float"</span></span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb145-19"><a href="#cb145-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb145-20"><a href="#cb145-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb145-21"><a href="#cb145-21" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-14" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-14">Test</h4>
<ol type="1">
<li><p>Verify the index template creation.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">_index_template/metrics_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Confirm there are no indices named <strong>metrics-</strong>*.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_cat/indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Index documents into the data stream.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">/metrics-ds/_doc</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"@timestamp"</span><span class="fu">:</span> <span class="st">"2024-05-16T12:34:56"</span><span class="fu">,</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"metric"</span><span class="fu">:</span> <span class="st">"cpu"</span><span class="fu">,</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"value"</span><span class="fu">:</span> <span class="dv">0</span><span class="er">.</span><span class="dv">5</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice the use of the <code>@timestamp</code> field. That is required for any documents going into a data stream.</p></li>
<li><p>This will return a result with the name of the backing index.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_index"</span><span class="fu">:</span> <span class="st">".ds-metrics-ds-2024.05.16-000001"</span><span class="fu">,</span> <span class="er">//</span> <span class="er">yours</span> <span class="er">will</span> <span class="er">be</span> <span class="er">different</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_id"</span><span class="fu">:</span> <span class="st">"P-YFy48BAvAOn4WaUvef"</span><span class="fu">,</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_version"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"result"</span><span class="fu">:</span> <span class="st">"created"</span><span class="fu">,</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_shards"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"total"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"successful"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"failed"</span><span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_seq_no"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"_primary_term"</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Run:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_cat/indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>The index will be listed.</p></li>
<li><p>Confirm the configuration of the backing index matches the index template (your backing index name will be different).</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">.ds-metrics-ds-2024.05.16-000001</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Run a search for the document that was indexed.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">.ds-metrics-ds-2024.05.16-000001/_search</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="considerations-14" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-14">Considerations</h4>
<ul>
<li>The <code>keyword</code> data type is chosen for the <code>metric</code> field to enable exact matching and filtering.</li>
<li>The <code>float</code> data type is chosen for the <code>value</code> field to enable precise numerical calculations.</li>
<li>One shard and one replica are chosen for simplicity and development purposes; in a production environment, this would depend on the expected data volume and search traffic.</li>
</ul>
</section>
<section id="clean-up-optional-14" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-14">Clean-up (optional)</h4>
<ul>
<li><p>Delete the data stream (deleting the data stream will also delete the backing index).</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">_data_stream/metrics-ds</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete the index template.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">_index_template/metrics_template</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-14" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-14">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-templates.html" target="_blank">Index templates</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/data-streams.html" target="_blank">Data streams</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html" target="_blank">Mapping types</a></li>
</ul>
</section>
</section>
<section id="example-4-defining-a-data-stream-with-specific-lifecycle-policies" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-4-defining-a-data-stream-with-specific-lifecycle-policies">Example 4: Defining a Data Stream with Specific Lifecycle Policies</h3>
<section id="requirements-15" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="requirements-15">Requirements</h4>
<ul>
<li>Create an index template named <code>logs_index_template</code>.</li>
<li>Create a data stream named <code>logs_my_app_production</code>.</li>
<li>Configure the data lifecycle:
<ul>
<li>Data is hot for 3 minutes.</li>
<li>Data rolls to warm immediately after 3 minutes.</li>
<li>Data is warm for 5 minutes.</li>
<li>Data rolls to cold after 5 minutes.</li>
<li>Data is deleted 10 minutes after rolling to cold.</li>
</ul></li>
</ul>
</section>
<section id="steps-12" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="steps-12">Steps</h4>
<ol type="1">
<li><p><strong>Create the Index Template</strong>:</p>
<ul>
<li>Define an index template named <code>logs_index_template</code> that matches the data stream <code>logs_my_app_production</code>.</li>
</ul>
<div class="sourceCode" id="cb155"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">_index_template/logs_index_template</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"index_patterns"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"logs_my_app_production*"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"data_stream"</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create the ILM Policy using the Elastic/Kibana UI{.unnumbered}</p>
<ol type="1">
<li><p>Open the hamburger menu and click on <strong>Management &gt; Data &gt; Index Life Cycle Policies</strong>.</p></li>
<li><p>Press <strong>+ Create New Policy</strong>.</p></li>
<li><p>Enter the following:</p></li>
</ol>
<ul>
<li>Policy name: <strong>logs-policy</strong></li>
<li><strong>Hot</strong> phase:
<ul>
<li>Advanced Settings &gt; Use Recommended Defaults (disable) &gt; Maximum Age: 7 Days</li>
</ul></li>
<li><strong>Warm</strong> phase (enable):
<ul>
<li>Move data into phase when: <strong>3 minutes</strong> old.</li>
<li>Leave <strong>Delete data after this phase</strong>.</li>
</ul></li>
<li><strong>Cold</strong> phase:
<ul>
<li>Move data into phase when: <strong>5 minutes</strong> old.</li>
<li>Leave <strong>Delete data after this phase</strong>.</li>
</ul></li>
<li><strong>Delete</strong> phase:
<ul>
<li>Move data into phase when: <strong>10 minutes</strong> old.</li>
</ul></li>
</ul>
<ol start="4" type="1">
<li><p>Press <strong>Save Policy</strong>.</p></li>
<li><p><strong>Management &gt; Data &gt; Index Life Cycle Policies &gt; [plus sign]</strong></p></li>
<li><p>Add Policy “logs-policy” to Index Template &gt; Index Template: logs_index_template &gt; Add Policy</p></li>
</ol></li>
</ol>
<p><strong>OR</strong></p>
<ol start="2" type="1">
<li><strong>Create the ILM Policy</strong>:
<ul>
<li>Define an Index Lifecycle Management (ILM) policy named <code>logs_index_policy</code> to manage the data lifecycle.</li>
</ul>
<div class="sourceCode" id="cb156"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">_ilm/policy/logs_index_policy</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"policy"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"phases"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"hot"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"min_age"</span><span class="fu">:</span> <span class="st">"0ms"</span><span class="fu">,</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"rollover"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"max_age"</span><span class="fu">:</span> <span class="st">"3m"</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"warm"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"min_age"</span><span class="fu">:</span> <span class="st">"3m"</span><span class="fu">,</span></span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"set_priority"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"priority"</span><span class="fu">:</span> <span class="dv">50</span></span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"cold"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"min_age"</span><span class="fu">:</span> <span class="st">"8m"</span><span class="fu">,</span></span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"set_priority"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"priority"</span><span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">}</span></span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"delete"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"min_age"</span><span class="fu">:</span> <span class="st">"18m"</span><span class="fu">,</span></span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"actions"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"delete"</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><strong>Create the Data Stream</strong>:
<ul>
<li>Creating the data stream is similar to creating an index using:</li>
</ul>
<div class="sourceCode" id="cb157"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">logs_my_app_production</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Create the data stream</li>
</ul>
<div class="sourceCode" id="cb158"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="er">PUT</span> <span class="er">/_data_stream/logs_my_app_production</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
</section>
<section id="test-15" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="test-15">Test</h4>
<ol type="1">
<li><strong>Index Sample Data</strong>:
<ul>
<li>Index some sample documents into the data stream to ensure it is working correctly.</li>
</ul>
<div class="sourceCode" id="cb159"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="er">POST</span> <span class="er">/logs_my_app_production/_doc</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"message"</span><span class="fu">:</span> <span class="st">"This is a test log entry"</span><span class="fu">,</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"@timestamp"</span><span class="fu">:</span> <span class="st">"2024-07-10T23:00:00Z"</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><strong>Verify ILM Policy</strong>:
<ul>
<li>Check the status of the ILM policy to ensure it is being applied correctly.</li>
</ul>
<div class="sourceCode" id="cb160"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="er">GET</span> <span class="er">/_ilm/explain/logs-policy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><strong>Monitor Data Lifecycle</strong>:
<ul>
<li>Monitor the data stream to ensure that documents transition through the hot, warm, cold, and delete phases as expected.</li>
</ul></li>
</ol>
</section>
<section id="considerations-15" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="considerations-15">Considerations</h4>
<ul>
<li>The <code>rollover</code> action in the hot phase ensures that the index rolls over after 3 minutes.</li>
<li>The <code>set_priority</code> action in the warm and cold phases helps manage resource allocation.</li>
<li>The <code>delete</code> action in the delete phase ensures that data is deleted 10 minutes after rolling to cold.</li>
</ul>
</section>
<section id="clean-up-optional-15" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="clean-up-optional-15">Clean-up (Optional)</h4>
<ul>
<li><p>Delete the data stream and index template to clean up the resources.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_data_stream/logs_my_app_production</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_index_template/logs_index_template</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="er">DELETE</span> <span class="er">/_ilm/policy/logs-policy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="documentation-15" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="documentation-15">Documentation</h4>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/data-streams.html" target="_blank">Elasticsearch Data Streams</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-templates.html" target="_blank">Elasticsearch Index Templates</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-lifecycle-management.html" target="_blank">Elasticsearch ILM Policies</a></li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./0.2-intro.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Introduction</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./2-searching-data.html" class="pagination-link" aria-label="Searching Data">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Searching Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>